<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width; initial-scale=1.0" />	
	<link rel="stylesheet" href="__RES__/common/base.css" />
	<link rel="stylesheet" href="__RES__/member/css/reg.css" />
</head>
<body>		
	<ul class="form">
		<li><span>用户名：</span><input class="text" name="username" type="text" /></li>	
		<li><span>密 码：</span><input class="text" name="password" type="password" /></li>	
		{if condition="1 eq config('use_captcha_id')"}
		<li class="clearfix"><span>验证码：</span><input class="text" name="captcha" type="text" /></li>
		<li class="clearfix"><span></span><img class="verifyimg reloadverify" src="{:url('member/Login/verify')}" alt="captcha" /></li>
		{/if}
		<li><span></span><input type="submit" id="send" value="登录" /></li>	
	</ul>	
</body>
<script src="__PUBLIC__/js/jquery/jquery-2.0.3.min.js"></script>
<script src="__PUBLIC__/js/jquery/jquery-migrate-1.2.1.min.js"></script>
<script>
	<?php if(1==config('use_captcha_id')){ ?>
		//刷新验证码
		var verifyimg = $(".verifyimg").attr("src");
	    $(".reloadverify").click(function(){
	        if( verifyimg.indexOf('?')>0){
	            $(".verifyimg").attr("src", verifyimg+'&random='+Math.random());
	        }else{
	            $(".verifyimg").attr("src", verifyimg.replace(/\?.*$/,'')+'?'+Math.random());
	        }
	    });	
	<?php } ?>
	$('#send').click(function(){
		
		var username=$("input[name='username']").val();
		var pwd=$("input[name='password']").val();
		
		<?php if(1==config('use_captcha_id')){ ?>
			var captcha=$("input[name='captcha']").val();		
			if(captcha==''){
				alert('请输入验证码');
				return false;
			}			
		<?php } ?>
		
		if(username==''){
			alert('请输入账号');
			return false;
		}else if(pwd==''){
			alert('请输入密码');
			return false;
		}
		
		$.post(
			"login",
			$('input[type=\'text\'],input[type=\'password\']'),
			function(d){
				if(d.error){
					alert(d.error);
				}else if(d.success){
					
					alert('登录成功');
					//id=top在base.html里面
					var user=$("#top",window.parent.document).find('ul.left');	//要搞清楚$('div','li') 和 $('div , li') 和 $('div  li') 区别
// $('div','li')是$(子，父)，是从父节点里找子，而不是找li外面的div
// $('div , li')才是找所有的div和li，之间不存在父子关系
// $('div li') 是找div里面所有li，包括子级，孙子级，总之就是div里面所有li，不管有几层关系					
					user.html('');					
					user.append('<li><a href="{:url(\'member/order_member/index\')}">会员中心</a></li><li><a href="{:url(\'/logout\')}">退出</a></li>');
					
					var cart=$("#top",window.parent.document).find('#cart a');	
					//在框架中，我用 JavaScript 获取 JSON 数据，组织成 HTML 代码，最后将其填充至上层文档的一个元素中。按照一般的写法，我们需要用到类似如下的语句：
// 1.window.parent.document.getElementById("myEle").innerHTML = html;

// 使用 jQuery ，写法如下：

// 1.$("#myEle", window.parent.document).html(html);

// 即指明了是在 window.parent.document 中查找 id=myEle 的元素。

// 随着前面的问题的解决（其实是对 jQuery 的了解不够），现在两种方案都可以实现我需要的效果了。

// 另外还有一种实现方式，代码如下：
// 1.parent.$("#myEle").html(html);

// 这种方法要求父文档也要调用 jQuery 。					
					cart.html('');					
					cart.append(d.total);
					
							
					parent.window.art.dialog.list['login'].close();		
				}
			}	
		);
		
	});

</script>
</html>